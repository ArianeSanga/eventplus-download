<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EventPlus - Convite</title>
    <link rel="stylesheet" href="style.css"/>
</head>

<body>

<h1>EventPlus</h1>
<p class="subtitle" id="subtitle">Carregando convite...</p>

<div class="card">

    <p id="hostName" class="host"></p>

    <div class="event-title" id="eventName">Carregando...</div>

    <div class="info-line"><b>ğŸ“… Data:</b> <span id="eventDate"></span></div>
    <div class="info-line"><b>ğŸ“ Local:</b> <span id="eventLocation"></span></div>

    <div class="event-description" id="eventDescription"></div>

    <div class="token-box">
        CÃ³digo de acesso:
        <br>
        <span id="token"></span>
    </div>

    <p class="instructions">
        Para visualizar este evento no aplicativo:<br>
        <b>Abra o EventPlus â†’ Entre como Convidado â†’ Digite o cÃ³digo acima.</b>
    </p>

    <script>
        const params = new URLSearchParams(window.location.search);

        const token = params.get("token");
        const eventId = params.get("eventId");
        const eventName = params.get("eventName");
        const eventDate = params.get("eventDate");
        const eventLocation = params.get("eventLocation");
        const eventDescription = params.get("eventDescription");
        const hostName = decodeURIComponent(params.get("hostName") || "");

        document.getElementById("eventName").innerText = eventName;

        // Local
        document.getElementById("eventLocation").innerText = eventLocation;

        // DescriÃ§Ã£o
        document.getElementById("eventDescription").innerText = eventDescription;

        // Token
        document.getElementById("token").innerText = token;

        document.getElementById("subtitle").innerText =
            `${hostName} estÃ¡ te convidando para o evento: ${eventName}`;

        // Converter data
        const dateMillis = parseInt(eventDate);
        if (!isNaN(dateMillis)) {
            const d = new Date(dateMillis);
            document.getElementById("eventDate").innerText =
                d.toLocaleDateString("pt-BR") +
                " Ã s " +
                d.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' });
        }

        // Abrir app via deep link
        const deepLink = `eventplus://invite?token=${token}&eventId=${eventId}`;
        window.location.href = deepLink;

        // Fallback para download
        setTimeout(() => {
            window.location.href = "https://github.com/ArianeSanga/eventplus-download/releases/download/v1.0/app-debug.apk";
        }, 1800);
    </script>

    <p style="margin-top: 20px;">Se o app nÃ£o abrir automaticamente, baixe abaixo:</p>

    <a class="button"
       href="https://github.com/ArianeSanga/eventplus-download/releases/download/v1.0/app-debug.apk">
        ğŸ“¥ Baixar EventPlus (APK)
    </a>

</div>

</body>
</html>